<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather App</title>
  <style>
    body {
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 30px;
  height: 100vh;
  margin: 0;
  background: linear-gradient(135deg, #d4fc79, #96e6a1);
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;
  color: #333;
}
    form {
      margin-bottom: 20px;
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    input {
  padding: 10px;
  width: 250px;
  border: none;
  border-radius: 5px;
  outline: none;
  box-shadow: none;
}

    .icon-btn {
      background: #2196F3;
      color: white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      cursor: pointer;
      transition: background 0.2s;
      border: none;
    }
    .icon-btn:hover {
      background: #1976D2;
    }
    .icon-btn svg {
      width: 20px;
      height: 20px;
      fill: white;
    }
    .suggestions {
  position: absolute;
  background: white;
  list-style: none;
  margin: 0;
  padding: 0;
  max-height: 200px;
  overflow-y: auto;
  width: 250px;
  z-index: 10;
  color: black;

  /* Remove border/line */
  border: none;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* optional soft shadow */
}

    .suggestions li { padding: 8px; cursor: pointer; }
    .suggestions li:hover { background: #eee; }
    .weather-card {
  background: rgba(0,0,0,0.5);
  padding: 20px;
  border-radius: 15px;
  display: inline-block;
  margin-top: 20px;
  color: white; /* <-- makes card text white */
}

    .forecast {
      margin-top: 30px;
    }
    .forecast-grid {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
   .forecast-day {
  background: rgba(0,0,0,0.5);
  padding: 12px;
  border-radius: 10px;
  width: 120px;
  transition: transform 0.2s;
  color: white; /* <-- forecast text white too */
}

    .forecast-day:hover { transform: scale(1.05); }
    .forecast-day img { width: 40px; }
  </style>
</head>
<body>
  <h1>üå¶Ô∏è Weather App</h1>
  <form method="POST">
    <input type="text" id="city" name="city" placeholder="Enter city name" required autocomplete="off">
    
    <!-- Search button -->
    <button type="submit" class="icon-btn" title="Search">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 001.48-5.34C15.29 5.01 12.28 2 8.64 2S2 5.01 2 8.39c0 3.38 3.01 6.39 6.64 6.39 1.61 0 3.09-.59 4.23-1.57l.27.28v.79l4.25 4.25c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L15.5 14zM4 8.39C4 6.02 6.01 4 8.64 4s4.64 2.02 4.64 4.39-2.01 4.39-4.64 4.39S4 10.76 4 8.39z"/>
      </svg>
    </button>

    <!-- GPS button -->
    <button type="button" id="locateBtn" class="icon-btn" title="Use My Location">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 8a4 4 0 100 8 4 4 0 000-8zm9 3h-1.07a8.004 8.004 0 00-6.93-6.93V3h-2v1.07A8.004 8.004 0 003.07 11H2v2h1.07a8.004 8.004 0 006.93 6.93V21h2v-1.07a8.004 8.004 0 006.93-6.93H21v-2z"/>
      </svg>
    </button>

    <ul id="suggestions" class="suggestions"></ul>
  </form>

  {% if weather %}
  <div class="weather-card">
    <h2>{{ weather.city }}, {{ weather.country }}</h2>
    <p>{{ weather.temperature }}¬∞C</p>
    <p>{{ weather.description }}</p>
    <img src="http://openweathermap.org/img/wn/{{ weather.icon }}@2x.png">
    <p>üí® Wind: {{ weather.wind }} m/s</p>
  </div>

  <div class="forecast">
    <h3>7-Day Forecast</h3>
    <div class="forecast-grid">
      {% for day in forecast %}
      <div class="forecast-day">
        <p><strong>{{ day.date }}</strong></p>
        <img src="http://openweathermap.org/img/wn/{{ day.icon }}.png">
        <p>{{ day.temp_max }}¬∞ / {{ day.temp_min }}¬∞</p>
        <p>{{ day.description }}</p>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <script>
    const input = document.getElementById("city");
    const suggestionsList = document.getElementById("suggestions");

    input.addEventListener("input", () => {
      const query = input.value;
      if (query.length < 2) {
        suggestionsList.innerHTML = "";
        return;
      }
      fetch(`/suggest?q=${query}`)
        .then(res => res.json())
        .then(data => {
          suggestionsList.innerHTML = "";
          data.forEach(item => {
            const li = document.createElement("li");
            li.textContent = item;
            li.addEventListener("click", () => {
              input.value = item;
              suggestionsList.innerHTML = "";
            });
            suggestionsList.appendChild(li);
          });
        });
    });

    document.getElementById("locateBtn").addEventListener("click", () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          fetch(`/weather_by_coords?lat=${lat}&lon=${lon}`)
            .then(res => res.json())
            .then(data => {
              if (!data.error) {
                document.getElementById("city").value = data.city;
                document.querySelector("form").submit();
              } else {
                alert("Error: " + data.error);
              }
            });
        }, () => {
          alert("Location access denied.");
        });
      } else {
        alert("Geolocation not supported.");
      }
    });
  </script>
</body>
</html>
